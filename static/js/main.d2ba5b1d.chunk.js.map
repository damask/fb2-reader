{"version":3,"sources":["db.js","constants/inboxListItems.jsx","fb2Parser.js","events.js","components/BookImporter.js","components/BookList.js","components/Reader.js","App.js","serviceWorker.js","index.js"],"names":["db","key","primaryText","leftIcon","active","openedDb","openDB","upgrade","createObjectStore","keyPath","autoIncrement","createIndex","bookExists","book","count","hashHex","addSection","section","add","addElement","element","getAllBooks","getAll","then","getBook","hash","get","getRootSection","getFromIndex","x","Fb2Parser","xml","this","ordinal","parentSectionId","title","querySelector","image","elements","querySelectorAll","parent","textContent","href","id","tagName","parseSection","tag","content","innerHTML","sectionId","e","bookId","body","sections","window","crypto","subtle","digest","TextEncoder","encode","buffer","Array","prototype","map","call","Uint8Array","toString","slice","join","parser","DOMParser","doc","parseFromString","description","author","annotation","imageInfo","imageHref","getAttribute","test","imageBinary","type","dispatch","detail","document","dispatchEvent","CustomEvent","on","types","do","subscription","forEach","addEventListener","BookImporter","fileInput","React","createRef","floating","primary","style","height","width","padding","onClick","current","click","onChange","event","file","target","files","reader","FileReader","a","result","parseDescription","isAlreadyAdded","Events","parseBody","console","error","readAsText","ref","BookList","props","useState","books","setBooks","setBook","useEffect","className","subtitle","avatar","src","role","expander","flat","expandable","expanded","history","push","readBook","Reader","match","params","topSection","setTopSection","run","align","alt","createBrowserHistory","App","addToast","text","action","autohide","setState","state","toasts","dismissToast","setPage","page","navItems","item","divider","hide","visible","renderNode","handleShow","getElementById","inboxListItems","toUpperCase","basename","aria-label","fullPage","focusOnMount","onShow","onHide","mobileDrawerType","NavigationDrawer","DrawerTypes","TEMPORARY_MINI","tabletDrawerType","PERSISTENT_MINI","desktopDrawerType","toolbarTitle","toolbarActions","icon","contentId","temporaryIcon","persistentIcon","contentClassName","path","component","from","to","onDismiss","autohideTimeout","PureComponent","Boolean","location","hostname","WebFontLoader","load","google","families","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.d2ba5b1d.chunk.js","sourcesContent":["import {openDB} from 'idb';\n\nconst BOOKS = 'books';\nconst SECTIONS = 'sections';\nconst ELEMENTS = 'elements';\n\nlet db;\n\nconst openedDb = openDB('fb2-reader', 1, {\n    upgrade(db) {\n        // Create a store of objects\n        const books = db.createObjectStore(BOOKS, {\n            keyPath: 'hashHex', autoIncrement: true\n        });\n        books.createIndex('author', 'author');\n\n        const sections = db.createObjectStore(SECTIONS, {\n            keyPath: 'id', autoIncrement: true\n        });\n        sections.createIndex('parent', 'parent');\n\n        const elements = db.createObjectStore(ELEMENTS, {\n            keyPath: ['sectionId', 'ordinal']\n        });\n        elements.createIndex('sectionId', 'sectionId');\n\n    }\n});\n\nopenedDb.then(x => db = x);\n\nexport function addBook(book) {\n    return db.add(BOOKS, book);\n}\n\nexport function bookExists(book) {\n    return db.count(BOOKS, book.hashHex);\n}\n\nexport function addSection(section) {\n    return db.add(SECTIONS, section);\n}\n\nexport function addElement(element) {\n    return db.add(ELEMENTS, element);\n}\n\nexport function getAllBooks() {\n    if (db) {\n        return db.getAll(BOOKS);\n    }\n    return openedDb.then(() => db.getAll(BOOKS));\n}\n\nexport function getBook(hash) {\n    if (db) {\n        return db.get(BOOKS, hash);\n    }\n    return openedDb.then(() => db.get(BOOKS, hash));\n}\n\nexport function getRootSection(hash) {\n    if (db) {\n        return db.getFromIndex(SECTIONS, 'parent', hash);\n    }\n    return openedDb.then(() => db.getFromIndex(SECTIONS, 'parent', hash));\n}\n\nexport function getSections(parent) {\n    return db.getAllFromIndex(SECTIONS, 'parent', parent);\n}\n","import React from 'react';\nimport { FontIcon } from 'react-md';\n\nexport default [{\n  key: 'books',\n  primaryText: 'Books',\n  leftIcon: <FontIcon>book</FontIcon>,\n  active: true,\n}, {\n  key: 'read',\n  primaryText: 'Read',\n  leftIcon: <FontIcon>assignment</FontIcon>,\n},{\n  key: 'drafts',\n  primaryText: 'Drafts',\n  leftIcon: <FontIcon>drafts</FontIcon>,\n}, {\n  key: 'trash',\n  primaryText: 'Trash',\n  leftIcon: <FontIcon>delete</FontIcon>,\n}];\n","import {addSection, addElement, addBook, bookExists} from \"./db.js\";\n\nfunction buf2hex(buffer) { // buffer is an ArrayBuffer\n    return Array.prototype.map.call(new Uint8Array(buffer), x => ('00' + x.toString(16)).slice(-2)).join('');\n}\n\nexport class Fb2Parser {\n    xml;\n    body;\n    book;\n    bookExists;\n\n    constructor(xml) {\n         this.xml = xml;\n         this.ordinal = 0;\n    }\n\n    async parseSection(section, parentSectionId) {\n        //  <p>, <image>, <poem>, <subtitle>, <cite>, <empty-line/>, <table>\n\n        const title = section.querySelector('title');\n        const image = section.querySelector('image');\n        const elements = section.querySelectorAll(':scope > *');\n\n        const id = await addSection({parent: parentSectionId, ordinal: this.ordinal++,\n            title: title?.textContent ?? null, image: image?.href ?? null });\n\n        for (const element of elements) {\n            if (element.tagName === 'section') {\n                await this.parseSection(element, id);\n            } else {\n                await addElement({\n                    tag: element.tagName,\n                    content: element.innerHTML,\n                    sectionId: id,\n                    ordinal: this.ordinal++\n                })\n            }\n        }\n    }\n\n    async parseBody() {\n        const bookId = await addBook(this.book);\n\n        // image, title, epigraph, section\n        const body = this.body;\n\n        const title = body.querySelector('title');\n        const image = body.querySelector('image');\n        const sections = body.querySelectorAll(':scope > section');\n\n        const id = await addSection({title: title?.textContent ?? null, image: image?.href ?? null,\n            ordinal: this.ordinal++, parent: bookId });\n        for (const section of sections) {\n            await this.parseSection(section, id);\n        }\n    }\n\n    async parseDescription() {\n        const hash = await window.crypto.subtle.digest(\"SHA-512\", new TextEncoder(\"utf-8\").encode(this.xml));\n        const hashHex = buf2hex(hash);\n\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(this.xml, \"application/xml\");\n        const description = doc.querySelector('description');\n\n        const author = description.querySelector('author first-name').textContent + ' ' +\n            description.querySelector('author last-name').textContent;\n        const title = description.querySelector('book-title');\n\n        let annotation = description.querySelector('annotation');\n        annotation = annotation && annotation.textContent;\n\n        // image\n        let image;\n        const imageInfo = description.querySelector('coverpage image');\n        if (imageInfo) {\n            const imageHref = imageInfo.getAttribute('l:href');\n            if (imageHref && /^#/.test(imageHref)) {\n                const id = imageHref.slice(1);\n                const imageBinary = doc.querySelector(`binary[id=\"${id}\"]`);\n                if (imageBinary) {\n                    const type = imageBinary.getAttribute('content-type');\n                    image = `data:${type};base64,${imageBinary.innerHTML}`;\n                }\n            }\n        }\n\n\n        const book = {hashHex, author: author, title: title.textContent, annotation, image};\n\n        this.body = doc.querySelector('body');\n        this.book = book;\n        this.bookExists = await bookExists(book);\n        return book;\n    }\n\n    get isAlreadyAdded() {\n        return this.bookExists;\n    }\n\n}\n\n","export const DB_READY = 'db-ready';\nexport const BOOK_ALREADY_ADDED = 'book-already-added';\nexport const BOOK_ADDING = 'book-adding';\nexport const BOOK_ADDED = 'book-added';\n\nexport function dispatch(type, detail) {\n    document.dispatchEvent(new CustomEvent(type, { detail }));\n}\n\nexport function on(...types) {\n    return {\n        do (subscription) {\n            types.forEach(type => document.addEventListener(type, subscription));\n        }\n    };\n}\n\n\n","import React from 'react';\r\nimport {Button} from \"react-md\";\r\nimport {Fb2Parser} from \"../fb2Parser\";\r\nimport * as Events from \"../events\";\r\n\r\nexport function BookImporter() {\r\n    const fileInput = React.createRef();\r\n\r\n    function change(event) {\r\n        const file = event.target.files[0];\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', async event => {\r\n            try {\r\n                const xml = event.target.result;\r\n                const parser = new Fb2Parser(xml);\r\n                const book = await parser.parseDescription();\r\n\r\n                if (parser.isAlreadyAdded) {\r\n                    Events.dispatch(Events.BOOK_ALREADY_ADDED, {book});\r\n                    return;\r\n                }\r\n\r\n                Events.dispatch(Events.BOOK_ADDING, {book});\r\n                await parser.parseBody();\r\n                Events.dispatch(Events.BOOK_ADDED, {book});\r\n            } catch (e) {\r\n                console.error('error when parsing', e);\r\n            }\r\n        });\r\n        reader.readAsText(file);\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Button floating primary style={{height: 32, width: 32, padding: 6}} onClick={() => fileInput.current.click()}>add</Button>\r\n            <input type=\"file\" id=\"file-selector\" onChange={change} ref={fileInput}/>\r\n        </div>\r\n    );\r\n\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport {PureComponent} from \"react\";\r\nimport {getAllBooks} from \"../db\";\r\nimport {BookImporter} from \"./BookImporter\";\r\nimport * as Events from \"../events\";\r\nimport {\r\n    Avatar,\r\n    Button,\r\n    Card,\r\n    CardActions,\r\n    CardText,\r\n    CardTitle,\r\n} from 'react-md';\r\nimport './BookList.css';\r\n\r\nexport function BookList(props) {\r\n\r\n    const [books, setBooks] = useState([]);\r\n    const [book, setBook] = useState(null);\r\n\r\n\r\n    Events.on(Events.BOOK_ADDING).do(event => {\r\n        setBook(event.detail.book);\r\n    });\r\n    Events.on(Events.BOOK_ADDED).do(async event => {\r\n        setBook(null);\r\n        setBooks(await getAllBooks());\r\n    });\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => setBooks(await getAllBooks()))();\r\n    }, []);\r\n\r\n\r\n    const readBook = book => props.history.push(`/read/${book.hashHex}`);\r\n\r\n    return (\r\n        <div>\r\n            <BookImporter></BookImporter><br/>\r\n            <div id=\"list\">\r\n                {\r\n                    book &&\r\n                    <Card key={book.title} className=\"loading\">\r\n                        <CardTitle title={book.title}\r\n                                   subtitle={book.author}\r\n                                   avatar={<Avatar src={book.image} role=\"presentation\"/>}\r\n                        />\r\n                        <CardActions expander>\r\n                            <Button flat>\r\n                                <div className=\"lds-dual-ring\"></div>\r\n                            </Button>\r\n                            <Button flat>\r\n                                Loading...\r\n                            </Button>\r\n                        </CardActions>\r\n                        <CardText expandable expanded={true}>\r\n                            {book.annotation}\r\n                        </CardText>\r\n                    </Card>\r\n                }\r\n                {\r\n                    books.map(book =>\r\n                        <Card key={book.title}>\r\n                            <CardTitle\r\n                                title={book.title}\r\n                                subtitle={book.author}\r\n                                avatar={<Avatar src={book.image} role=\"presentation\"/>}\r\n                            />\r\n                            <CardActions expander>\r\n                                <Button flat onClick={() => readBook(book)}>Read</Button>\r\n                                <Button flat>Delete</Button>\r\n                            </CardActions>\r\n                            <CardText expandable>\r\n                                {book.annotation}\r\n                            </CardText>\r\n                        </Card>\r\n                    )\r\n                }</div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","import React, {useEffect, useMemo, useState} from 'react';\r\nimport {PureComponent} from \"react\";\r\nimport {getBook, getRootSection, getSections} from \"../db\";\r\n\r\nexport async function Reader(props) {\r\n    const hash = props.match.params.hash;\r\n    const [book, setBook] = useState(null);\r\n    const [topSection, setTopSection] = useState(null);\r\n\r\n    useEffect( () => {\r\n        async function run() {\r\n            debugger\r\n            const book = await getBook(hash);\r\n            setBook(book);\r\n            setTopSection(await getRootSection(hash));\r\n        }\r\n        run();\r\n    }, [hash])\r\n\r\n    // rendering algo\r\n    // get first non-section element - draw: sections and element\r\n    // get next sibling if there is - draw - intersection observer\r\n    // ..\r\n    // when no next sibling\r\n\r\n    debugger\r\n\r\n    return (\r\n        <div>\r\n            { book &&\r\n                <div>\r\n                    <h2>{book.title}</h2>\r\n                    <div>\r\n                        <div><img src={book.image} align=\"left\" alt={book.title}/>{book.annotation}</div>\r\n                        <br/>\r\n                        <h3>{topSection.title}</h3>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n","/* eslint-disable react/no-array-index-key */\nimport React, {PureComponent} from 'react';\nimport './App.css';\nimport {Button, DialogContainer, FontIcon, NavigationDrawer, Snackbar} from 'react-md';\nimport inboxListItems from './constants/inboxListItems';\nimport {BookList} from './components/BookList';\nimport * as Events from \"./events\";\n\n\nimport {BrowserRouter, Redirect, Route, Switch} from \"react-router-dom\";\n\nimport {createBrowserHistory} from 'history';\nimport {Reader} from \"./components/Reader\";\n\n// создаём кастомную историю\nconst history = createBrowserHistory();\n\nexport default class App extends PureComponent {\n    constructor() {\n        super();\n\n        // Update the items so they have an onClick handler to change the current page\n        this.navItems = inboxListItems.map((item) => {\n            if (item.divider) {\n                return item;\n            }\n\n            return {\n                ...item,\n                onClick: () => this.setPage(item.key, item.primaryText),\n            };\n        });\n\n        this.state = {\n            toasts: [],\n            renderNode: null,\n            visible: true,\n            key: inboxListItems[0].key,\n            page: inboxListItems[0].primaryText,\n        };\n\n        Events.on(Events.BOOK_ALREADY_ADDED).do(event => {\n            const book = event.detail.book;\n            debugger\n            this.addToast(`Book \"${book.title.toUpperCase()}\" has been added earlier!`);\n        });\n    }\n\n    addToast = (text, action, autohide = true) => {\n        this.setState((state) => {\n            const toasts = state.toasts.slice();\n            toasts.push({text, action});\n            return {toasts, autohide};\n        });\n    }\n\n    dismissToast = () => {\n        const [, ...toasts] = this.state.toasts;\n        this.setState({toasts});\n    };\n\n    setPage = (key, page) => {\n        this.navItems = this.navItems.map((item) => {\n            if (item.divider) {\n                return item;\n            }\n\n            return {...item, active: item.key === key};\n        });\n\n        this.setState({key, page});\n    };\n\n    hide = () => {\n        this.setState({visible: false, renderNode: null});\n    };\n\n    handleShow = () => {\n        this.setState({renderNode: document.getElementById('navigation-drawer-demo')});\n    };\n\n    render() {\n        const {visible, renderNode, toasts} = this.state;\n        return (\n            <BrowserRouter history={history} basename={'/fb2-reader'}>\n                <div>\n                    <DialogContainer\n                        id=\"navigation-drawer-demo\"\n                        aria-label=\"Navigation Drawer Demo\"\n                        visible={visible}\n                        fullPage\n                        focusOnMount={false}\n                        onShow={this.handleShow}\n                        onHide={this.hide}>\n                        <NavigationDrawer\n                            renderNode={renderNode}\n                            navItems={this.navItems}\n                            mobileDrawerType={NavigationDrawer.DrawerTypes.TEMPORARY_MINI}\n                            tabletDrawerType={NavigationDrawer.DrawerTypes.PERSISTENT_MINI}\n                            desktopDrawerType={NavigationDrawer.DrawerTypes.PERSISTENT_MINI}\n                            toolbarTitle=\"FB2 Reader\"\n                            toolbarActions={<Button icon onClick={this.hide}>close</Button>}\n                            contentId=\"main-demo-content\"\n                            temporaryIcon={<FontIcon>menu</FontIcon>}\n                            persistentIcon={<FontIcon>arrow_back</FontIcon>}\n                            contentClassName=\"md-grid\">\n\n                            <Switch>\n                                <Route path='/books' component={BookList}/>\n                                <Route path='/read/:hash' component={Reader}/>\n                                <Redirect from='/' to='/books'/>\n                            </Switch>\n\n                        </NavigationDrawer>\n                        <Snackbar\n                            id=\"example-snackbar\"\n                            toasts={toasts}\n                            autohide={true}\n                            onDismiss={this.dismissToast}\n                            autohideTimeout={4000}\n                        />\n                    </DialogContainer>\n                </div>\n            </BrowserRouter>\n        );\n    }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport WebFontLoader from 'webfontloader';\n\nWebFontLoader.load({\n    google: {\n        families: ['Roboto:300,400,500,700', 'Material Icons'],\n    },\n});\n\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}